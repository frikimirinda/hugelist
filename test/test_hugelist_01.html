<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mirinda.es - Hugelist tester - hugelist.js</title>
    <link rel="stylesheet" href="test.css" type="text/css" media="all">
    <style>
        @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css");
        @import url("https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css");

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f0f2f5;
            color: #333;
            padding: 20px;
            overflow-y: hidden;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #1a1a2e;
        }

        h2 {
            margin: 0 0 15px 0;
            color: #16213e;
            border-bottom: 2px solid #0f3460;
            padding-bottom: 8px;
        }
        
        header .logo-left{
            width: 20%;
        }
        header .logo-mirinda{
            width: 15%;
        }
        header h3{
            font-size: 1.5rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            -gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .result {
            font-family: monospace;
            color: #266117;
            font-weight: bold;
        }

        .ok {
            color: #27ae60;
        }

        .fail {
            color: #e74c3c;
        }

        .help{
            border: 2px solid blue;
            padding: 5px;
            border-radius: 15px;
            background-color: aliceblue;
            font-size: smaller;            
        }

        @keyframes flash-naranja {
            0% {
                background-color: orange;
            }

            100% {
                background-color: transparent;
            }
        }

        .flash-naranja {
            animation: flash-naranja 2s ease-out;
        }

        .github-corner:hover .octo-arm {
            animation: octocat-wave 560ms ease-in-out
        }
       
        @keyframes octocat-wave {

            0%,
            100% {
                transform: rotate(0)
            }

            20%,
            60% {
                transform: rotate(-25deg)
            }

            40%,
            80% {
                transform: rotate(10deg)
            }
        }

        @media (max-width:500px) {
            .github-corner:hover .octo-arm {
                animation: none
            }

            .github-corner .octo-arm {
                animation: octocat-wave 560ms ease-in-out
            }
        }
    </style>
    <link rel="stylesheet" href="hugelist.css" type="text/css" media="all">
</head>

<body>

    <a href="https://github.com/frikimirinda/hugelist" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80"
            viewBox="0 0 250 250" style="fill:#2563eb;; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" />
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm" />
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body" />
        </svg></a>

    <div class="grid" -style="max-width: 90%;">

        <header class="logos" style="display: flex; justify-content: space-between; align-items: center;">
            <a href="https://github.com/frikimirinda/hugelist" target="_blank" class="logo-left"><img src="assets/logo_hg.svg" style="width: 100%;"></a>
            <h3>
                testing hugelist.js
                <button class="btn btn-info" onclick="$('#hlp').toggle()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94" />
                    </svg>
                    help
                </button>
            </h3>
            <a href="https://mirinda.es" target="_blank" class="logo-mirinda"><img src="assets/mirinda_es.svg" style="width:100%"></a>
        </header>


                <div class="col help" id="hlp" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                        <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94" />
                    </svg>
                    Some notes:
                    <ul>
                        <li>Cursor up/down: move up down on list records</li>
                        <li>Page up/down: move to next/previos page</li>
                        <li>Home: move to first page</li>
                        <li>End: move to last page</li>
                        <li>Mouse scroll to page up and down</li>
                        <li>You can move the list columns by dragging the headers horizontally</li>
                        <li>You can rightClick on any header to show or hide a column</li>
                    </ul>
                    How the search works:
                    <ul>
                        <li>Juan — searches for "Juan" (normal behavior)</li>
                        <li>Juan Pedro — searches for records containing either "Juan" or "Pedro" (OR by spaces, as
                            before)</li>
                        <li>Juan+Madrid — searches for records containing both "Juan" and "Madrid" (AND by +)</li>
                        <li>Juan+Madrid+Programmer — all three must be present in the record</li>
                        <li>Each part separated by + is searched independently in the selected fields (or in all fields
                            if none are selected).</li>
                        <li>The + takes precedence: if there is a + in the search, AND is used between groups. If there
                            is no +, it works as before (spaces = OR, or & at the beginning for AND).</li>
                    </ul>
                </div>



        <div id="list_container" class="rowDashboard container" -style="max-width: 100%;">
            <div class="row">
                <form onsubmit="listado1.search(); return false;">
                    <div class="input-group mb-3">
                        <span class="input-group-text">Search...</span>
                        <input type="text" id="buscar" class="form-control" placeholder="...anything...(read help)">
                        <span class="input-group-text">...in fields</span>
                        <select id="fld2find" class="form-control">
                        </select>
                        <button class="btn btn-primary" type="submit" id="buscar">Search</button>
                    </div>

                </form>
                <div class="row">
                    <div class="col">
                        <p id="info"></p>
                    </div>
                    <div class="col input-group ">
                        <select id="indexMode" class="form-select" onchange="listado1.indexModeChanged(this)">
                            <option selected value="0">do not index data on load</option>
                            <option value="1">index data on load</option>
                        </select>
                        <select id="ramount" class="form-select" aria-label="Default select example">
                            <option>select amount of records to load</option>
                            <option selected value="1000">1.000 records</option>
                            <option value="10000">10.000 records</option>
                            <option value="25000">25.000 records</option>
                            <option value="50000">50.000 records</option>
                            <option value="100000">100.000 records</option>
                            <option value="150000">150.000 records</option>
                            <option value="300000">300.000 records</option>
                            <option value="500000">500.000 records</option>
                            <option value="1000000">1.000.000 records</option>
                        </select>
                        <button class="btn btn-primary" type="button" id="load"
                            onclick="listado1.loadData()">load</button>
                    </div>
                </div>
            </div>
            <div id="brw" class="table-responsive" style="max-width:100%"></div>
        </div>



        <script src="https://code.jquery.com/jquery-4.0.0.min.js"></script>
        <script src="../src/hugelist.js"></script>
        <script type="module">
            import { Picture } from "https://cdn.jsdelivr.net/gh/frikimirinda/picture@v.1.0.0/dist/picture.min.js";
            window.Picture = Picture; 
        </script>
        <script type="module">
            //    import { Picture } from "../src/picture.js";
            //    window.Picture = Picture; 
        </script>


        <script type="text/javascript">
            window.listado1 = {
                title: "TEST HUGELIST",
                //_PSOURCE:'{$_PSOURCE}',
                f: null,
                brw: null,
                init: function () {
                    this.f = $('#list_container');
                    this.brw = new HugeList;
                    setTimeout($.proxy(function () { this.loadData(); }, this), 100);
                    //this.f.find('#brw').on('click', function (){listado1.clickRow()} );
                    let brw=document.getElementById('brw');
                    // You can add event listener here or declare the event callback functions when call for request data (data_server.php)
                    //    brw.addEventListener('clickRow',$.proxy(function (){this.clickRow()} ) );
                    //    brw.addEventListener('dblclickRow',$.proxy(function (){this.dblclickRow()} ) );
                    brw.addEventListener('keydown',$.proxy(function (){ console.log('keydown') } ) );
                    brw.addEventListener('wheel',$.proxy(function (){ console.log('wheel') } ) );
                    brw.addEventListener('contextmenu',$.proxy(function (){ console.log('contextmenu') } ) );
                },
                loadData: function () {
                    let datos = {
                        'ramount': (document.getElementById('ramount').value ?? 1000),
                    };
                    let options = {
                        //'url':'https://www.amuralarte.es/mirinda/data_sample_1.php',
                        'url': 'https://mirinda-local.es/hugelist/test/data_server.php',
                        'cmd': 'getDatos',
                        'data': datos,
                        'ctlid': 'brw',
                        'events': {
                            'beforeInit': $.proxy(function (ret) {
                                console.log('beforeInit event');
                                ret.data.data = JSON.parse(ret.data.data);
                            }),
                            'afterInit': $.proxy(function () {
                                const end = performance.now();
                                // Montar select con los campos para el filtro de búsqueda
                                console.log('afterInit  event');
                                this.f.find('#fld2find').html('');
                                this.f.find('#fld2find').append(`<option value=''>ALL FIELDS</option>`);
                                for (const [k, fld] of this.brw.fld.entries()) {
                                    this.f.find('#fld2find').append(`<option value='${fld.name}'>${fld.label}</option>`);
                                }
                                const ms = (end - this.start).toFixed(3).toLocaleString();
                                const sg = (ms / 1000).toFixed(3);
                                const nr = (this.brw.data.length ?? 0).toLocaleString();
                                this.showInfo(`${nr} records loaded in ${ms} ms (${sg} seconds)`);
                            }, this),
                            'startIndexing': $.proxy(function () {
                                this.startIndexingTime = performance.now();
                                console.log('Indexing start (startIndexing event)');
                            }),
                            'endIndexing': $.proxy(function () {
                                const end = performance.now();
                                const ms = (end - this.startIndexingTime).toFixed(3).toLocaleString();
                                const sg = (ms / 1000).toFixed(3);
                                console.log(`Indexing end (endIndexing event)... ${ms}ms (${sg} seconds)`);
                            }),
                        },
                        'callbacks': {
                            '_formatRow': $.proxy(function (ret) {
                                // ret.idx is the index of the row in the original data
                                // ret.data is a copy of the original data, so you can modify it without affecting the original data
                                // ret.fld is the array of field names
                                // ret.realdata is the original data, so you can modify it if you want to modify the original data
                                if (1 == 0) {
                                    console.log('formatRow callback idx', ret.idx);
                                    console.log(ret);
                                    ret.data[2] = ret.data[2] + '*';
                                    // You can modify realdata if you want to modify the original data
                                    // ret.realdata[2] = ret.realdata[2] + '---';
                                    return ret.data;
                                }
                            }),
                            'formatTotals': $.proxy(function (ret) {
                                console.log('formatTotals callback');
                                console.log(ret);
                                ret.data[4] = '';
                                ret.data[3] = ret.data[0]+' records';
                                ret.data[0] = '';
                            }),
                        }
                    }
                    this.start = performance.now();
                    this.brw.requestServerData(options);
                },
                indexModeChanged(o) {
                    this.brw.indexOnLoad = o.value * 1;
                },

                clickRow: function (data, idx) {
                    console.log('clickRow', data);
                    console.log('tr idx', idx);
                    console.log('data from idx', listado1.brw.data[idx]);
                    console.log('data from idx - getData', listado1.brw.getData(idx));
                },
                dblclickRow: function (data, idx) {
                    console.log('dblclickRow', data);
                    console.log('tr idx', idx);
                    console.log('data from idx', listado1.brw.data[idx]);
                    console.log('data from idx - getData', listado1.brw.getData(idx));
                },
                search: function (buscar) {
                    if (buscar == undefined)
                        buscar = this.f.find('#buscar').val().trim();
                    buscar = buscar.normalize('NFD').replace(/[\u0300-\u036f]/g, "");
                    const quecampo = this.f.find('#fld2find').val();
                    this.f.find('#buscar').val(buscar);
                    let nr = 0;
                    this.showInfo('Searching...');
                    if (buscar.length > 0) {
                        nr = this.brw.dataFind(buscar, quecampo);
                    } else {
                        nr = this.brw.dataFindReset();
                    }
                    this.showInfo(nr + ' records found');
                },
                showInfo: function (s) {
                    this.f.find('#info').html(s);
                    this.f.find('#info').addClass('flash-naranja').on('animationend', function () {
                        $(this).removeClass('flash-naranja');
                    });
                }

            }
            window.onresize = function () {
                listado1.brw.resize();
            }
            window.listado1.init();
        </script>

</body>

</html>